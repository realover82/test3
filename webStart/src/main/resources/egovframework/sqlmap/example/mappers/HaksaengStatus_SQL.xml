<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.haksaengStatus.service.impl.HaksaengStatusMapper">

	<select id="selectHaksaengStatusServiceList" resultType="egovMap" parameterType="egovMap">
    
<!-- 	<select id="selectHaksaengStatusServiceList" resultType="egovMap" > -->
		SELECT *	
	    FROM 
	    (SELECT FORMAT ((@rownum := @rownum +1), 0) num
			,u.user_id
			,u.user_nm
			,u.age
			,u.cafe_nick
			,u.phone
			,gs.class_nm
			,gs.gisu_nm
			,gs.jucha_nm
			FROM t_user u
			,t_gisu gs
			, (Select @rownum := 0) rownum
			WHERE u.user_id = gs.user_id
			UNION ALL
			SELECT FORMAT ((@rownum := @rownum +1), 0) num
			,u.user_id
			,u.user_nm
			,u.age
			,u.cafe_nick
			,u.phone
			,'생존' class_nm
			,'없다' gisu_nm
			,'없엉' jucha_nm
			FROM t_user u
			WHERE EXISTS (SELECT 1
			FROM t_gisu gs
			WHERE u.user_id = gs.user_id)) A
			
			<where>
			    <if test="userNm != null and userNm != ''">
			        AND A.user_nm = #{userNm}
			    </if>
			    <if test="classNm != null and classNm != ''">
			        AND A.class_nm = #{classNm}
			    </if>
<!-- 			    <if test="userId != null and userId != ''"> -->
<!-- 			        AND A.user_id = #{userId} -->
<!-- 			    </if> -->
			</where>
	</select>
	
	<select id="selectHaksaengChartStatusServiceList" resultType="egovMap">
			SELECT A.class_nm	
			, COUNT(*) cnt
			FROM	(
			
			SELECT gs.class_nm

			FROM t_user u
			JOIN	t_gisu gs
			ON	u.user_id = gs.user_id

			UNION ALL
			
			SELECT '생존전략' class_nm
			FROM t_user u
			WHERE EXISTS (SELECT 1
			FROM t_gisu gs
			WHERE u.user_id = gs.user_id)) A
			GROUP	BY	A.class_nm
	</select>

<!-- 	<select id="selectHaksaengStatusServiceList" resultType="egovMap" parameterType="egovMap"> -->
<!-- 		SELECT *	 -->
<!-- 	    FROM -->
<!-- 	    (SELECT FORMAT ((@rownum := @rownum +1), 0) num -->
<!-- 			,u.user_id -->
<!-- 			,u.user_nm -->
<!-- 			,u.age -->
<!-- 			,u.cafe_nick -->
<!-- 			,u.phone -->
<!-- 			,gs.class_nm -->
<!-- 			,gs.gisu_nm -->
<!-- 			,gs.jucha_nm -->
<!-- 			FROM t_user u -->
<!-- 			,t_gisu gs -->
<!-- 			, (Select @rownum := 0) rownum -->
<!-- 			WHERE u.user_id = gs.user_id -->
<!-- 			UNION ALL -->
<!-- 			SELECT FORMAT ((@rownum := @rownum +1), 0) num -->
<!-- 			,u.user_id -->
<!-- 			,u.user_nm -->
<!-- 			,u.age -->
<!-- 			,u.cafe_nick -->
<!-- 			,u.phone -->
<!-- 			,'생존' class_nm -->
<!-- 			,'없다' gisu_nm -->
<!-- 			,'없엉' jucha_nm -->
<!-- 			FROM t_user u -->
<!-- 			WHERE EXISTS (SELECT 1 -->
<!-- 			FROM t_gisu gs -->
<!-- 			WHERE u.user_id = gs.user_id)) A -->
			
<!-- 			<where> -->
<!-- 			    <if test="userNm != null and userNm != ''"></if> -->
<!-- 	A.user_nm = #{userNm} -->
<!-- 			</where> -->
<!-- 	</select> -->

	<select id="stringParam" parameterType="String" resultType="egovMap" >
    
<!-- 	<select id="selectHaksaengStatusServiceList" resultType="egovMap" > -->
		SELECT *	
	    FROM 
	    (SELECT FORMAT ((@rownum := @rownum +1), 0) num
			,u.user_id
			,u.user_nm
			,u.age
			,u.cafe_nick
			,u.phone
			,gs.class_nm
			,gs.gisu_nm
			,gs.jucha_nm
			FROM t_user u
			,t_gisu gs
			, (Select @rownum := 0) rownum
			WHERE u.user_id = gs.user_id
			UNION ALL
			SELECT FORMAT ((@rownum := @rownum +1), 0) num
			,u.user_id
			,u.user_nm
			,u.age
			,u.cafe_nick
			,u.phone
			,'생존' class_nm
			,'없다' gisu_nm
			,'없엉' jucha_nm
			FROM t_user u
			WHERE EXISTS (SELECT 1
			FROM t_gisu gs
			WHERE u.user_id = gs.user_id)) A
			
			<where>
			    <if test="_parameter != null and _parameter != ''">
			        A.user_nm = #{_parameter}
			    </if>
<!-- 			    <if test="userId != null and userId != ''"> -->
<!-- 			        AND A.user_id = #{userId} -->
<!-- 			    </if> -->
			</where>
	</select>

	<select id="paramVO" parameterType="haksaengStatusVO" resultType="egovMap" >
    
<!-- 	<select id="selectHaksaengStatusServiceList" resultType="egovMap" > -->
		SELECT *	
	    FROM t_user ur
	    WHERE ur.user_nm = #{userNm}
	    OR ur.user_id = #{userId}
	    OR ur.age = #{age}
	</select>		
	
	<select id="selectClassServiceList" resultType="egovMap" >
    
<!-- 	<select id="selectHaksaengStatusServiceList" resultType="egovMap" > -->
		SELECT	gs.class_nm
		FROM	t_gisu gs
		GROUP BY	gs.class_nm
		
		UNION	ALL	
		
		SELECT	'생존' class_nm
	</select>		
	<select id="selectMainPartsServiceList" resultType="egovMap" >
    
<!-- 	<select id="selectHaksaengStatusServiceList" resultType="egovMap" > -->
		SELECT mp.parts_cd
     		 , mp.parts_nm
		FROM	t_main_parts mp
	</select>		
	
	<select id="selectPartsDtlServiceList" parameterType="String" resultType="egovMap" >
    
	SELECT	mpo.opt_cd
		 , mpo.opt_nm
	FROM	t_main_parts_opt mpo
	<where>
<!-- 		mpo.parts_cd = 'P0001' -->
		mpo.parts_cd = #{_parameter}
	    
	</where>

<!-- 	SELECT mn.MENU_CAT_CD -->
<!-- 	     		 , mn.MENU_NM -->
<!-- 	FROM	t_menu mn -->
<!-- 		<where> -->
<!-- 			mn.MENU_CAT_CD = 'C0001' -->
<!-- 		mpo.parts_cd = 'P0001' -->
<!-- 		mn.MENU_CAT_CD = #{_parameter} -->
	    
<!-- 	</where> -->

	</select>	
	
<!-- 		<select id="selectMainHoonServiceList" parameterType="String" resultType="egovMap" > -->
    
<!-- 	<select id="selectHaksaengStatusServiceList" resultType="egovMap" > -->
<!-- 		SELECT mp.parts_cd -->
<!--      		 , mp.parts_nm -->
<!-- 		FROM	t_main_parts mp -->
<!-- 	SELECT mn.MENU_CAT_CD -->
<!-- 	     		 , mn.MENU_NM -->
<!-- 	FROM	t_menu mn -->
<!-- 		<where> -->
<!-- 		mpo.parts_cd = 'P0001' -->
<!-- 		mn.MENU_CAT_CD = 'C0001' -->
<!-- 		mn.MENU_CAT_CD = #{_parameter} -->
	    
<!-- 	</where> -->
<!-- 	</select>	 -->

		
</mapper>